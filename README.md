# FILETREEFORGE v2.1

A production-ready VS Code extension for editing and applying project folder structures using **Markdown representation with tree symbols**.

**v2.1 - Critical Bug Fix:** Parser no longer creates files from headers/comments. Now truly production-ready!

## ğŸ¯ Features

- **Markdown-Only**: Clean, readable tree format with visual symbols
- **UUID-Based Tracking**: Stable node identification for rename detection
- **Filesystem Drift Detection**: Warns when files change outside the extension
- **Safe Operations**: Preview changes, confirm deletions, workspace-scoped
- **Smart Keybindings**: `Ctrl+Shift+Enter` to preview, `Ctrl+Enter` to apply
- **Auto-Close**: Temporary documents close after successful apply

## ğŸ“¦ Installation

1. Clone this repository
2. Run `npm install`
3. Run `npm run compile`
4. Press `F5` to open Extension Development Host

## ğŸš€ Quick Start

### 1. Generate a Tree

**Right-click any folder** â†’ `FILETREEFORGE: Generate Markdown Tree`

This creates a document like:

```markdown
<!-- FILETREEFORGE FORMAT v1 -->

# ROOT FOLDER : Login

# GENERATED : 2/8/2026, 10:45:51 PM

# ROOT PATH : C:\project\src\components\Login

login/
â”œâ”€ login-imgs/ <!-- id: a3f2c1d4 -->
â”‚ â”œâ”€ bg-cover-login.jpg <!-- id: 7f2c5e8b -->
â”‚ â”œâ”€ login-img1.jpg <!-- id: 9d4e6a2f -->
â”‚ â”œâ”€ login-img2.jpg <!-- id: 5b8c3f1e -->
â”‚ â”œâ”€ login-img3.jpg <!-- id: 2a9f7d4c -->
â”‚ â””â”€ login-img4.jpg <!-- id: 8e3b5c9a -->
â”œâ”€ Login.css <!-- id: 6c2d8f4b -->
â””â”€ Login.jsx <!-- id: 4f9e2a7d -->

# Generated by FILETREEFORGE

# Shortcuts

# Ctrl + Shift + Enter â†’ Preview

# Ctrl + Enter â†’ Apply Changes

# IMPORTANT RULES

# - For renames: change the file name and KEEP the <!-- id: xxxxxxxx -->

# - Changing a file name WITHOUT an id = delete old + create new
```

### 2. Edit the Tree

Add, remove, or reorganize files:

```markdown
login/
â”œâ”€ login-imgs/ <!-- id: a3f2c1d4 -->
â”‚ â”œâ”€ bg-cover-login.jpg <!-- id: 7f2c5e8b -->
â”‚ â””â”€ new-image.jpg <!-- NEW FILE -->
â”œâ”€ Login.css <!-- id: 6c2d8f4b -->
â”œâ”€ Login.jsx <!-- id: 4f9e2a7d -->
â””â”€ LoginForm.jsx <!-- NEW FILE -->
```

### 3. Preview Changes

**Press `Ctrl+Shift+Enter`** (or `Cmd+Shift+Enter` on Mac)

You'll see:

```
PREVIEW MODE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ” Ctrl + Enter â†’ Apply Changes
âœ– Esc â†’ Cancel

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2 operation(s) to apply:

CREATE (2):
  ğŸ“„ login-imgs/new-image.jpg
  ğŸ“„ LoginForm.jsx
```

### 4. Apply Changes

**Press `Ctrl+Enter`** (or `Cmd+Enter` on Mac)

Filesystem updated! Tree and preview tabs auto-close.

## ğŸ” Filesystem Drift Detection

If files change outside the extension, you'll see:

```
âš ï¸ FILESYSTEM DRIFT DETECTED

The filesystem has changed since last apply:

ADDED (1):
  + config.json

DELETED (1):
  - old-file.txt

Please choose how to proceed.
```

**Options:**

- **Refresh Baseline**: Regenerate tree from current filesystem
- **Continue Anyway**: Apply changes despite drift (advanced)
- **Cancel**: Stop and investigate

## âŒ¨ï¸ Keyboard Shortcuts

| Action  | Windows/Linux      | Mac               | When                  |
| ------- | ------------------ | ----------------- | --------------------- |
| Preview | `Ctrl+Shift+Enter` | `Cmd+Shift+Enter` | Markdown file focused |
| Apply   | `Ctrl+Enter`       | `Cmd+Enter`       | Markdown file focused |

**Important:** `Ctrl+S` only saves the file (normal behavior)

## ğŸ¨ Markdown Format

### Tree Symbols

- `â”œâ”€` : Item in the middle of a list
- `â””â”€` : Last item in a list
- `â”‚` : Continuation line
- `/` : Folder (trailing slash)

### UUID Comments

Each node has a hidden UUID for rename detection:

```markdown
â”œâ”€ Button.tsx <!-- id: 7f2c5e8b -->
```

**UUID Rules:**

- Same UUID, different name/path â†’ RENAME
- Missing UUID â†’ DELETE
- New UUID â†’ CREATE

## âš™ï¸ Configuration

```json
{
  "filetreeforge.confirmBeforeApply": true,
  "filetreeforge.ignorePatterns": [
    "node_modules",
    ".git",
    ".vscode",
    "dist",
    "out",
    "build"
  ]
}
```

### Settings

- **confirmBeforeApply**: Show confirmation before applying (default: `true`)
- **ignorePatterns**: Folders/files to ignore when generating (default: common build folders)

## ğŸ›¡ï¸ Safety Features

### Path Validation

- âœ… All paths validated against workspace root
- âŒ No absolute paths allowed
- âŒ No `..` parent references
- âŒ No symlinks followed

### Operation Ordering

1. **Create folders** (parent first)
2. **Create files**
3. **Rename files/folders**
4. **Delete files**
5. **Delete folders** (deepest first)

### Drift Detection

- Always re-scans filesystem before preview/apply
- Warns if files changed outside extension
- Prevents applying stale diffs

### Auto-Close

- Generated tree tabs close after apply
- Preview tabs close after apply
- Source files remain open

## ğŸ“‹ Workflow

```
Right-click folder â†’ Generate Markdown Tree
           â†“
    Edit tree manually
           â†“
Ctrl+Shift+Enter â†’ Preview
           â†“
  Filesystem drift check
           â†“
    Ctrl+Enter â†’ Apply
           â†“
Auto-close tree & preview tabs
```

## ğŸ”¬ Architecture

```
src/
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ generateTree.ts       # Filesystem â†’ Markdown
â”‚   â”œâ”€â”€ previewChanges.ts     # Drift check + preview
â”‚   â”œâ”€â”€ applyChanges.ts       # Apply with auto-close
â”‚   â””â”€â”€ stateManager.ts       # Baseline + temp docs
â”œâ”€â”€ parser/
â”‚   â”œâ”€â”€ markdownParser.ts     # Parse with UUID support
â”‚   â””â”€â”€ treeSerializer.ts     # Generate with tree symbols
â”œâ”€â”€ diff/
â”‚   â””â”€â”€ diffTrees.ts          # UUID-based comparison
â”œâ”€â”€ fs/
â”‚   â”œâ”€â”€ applyDiff.ts          # Safe filesystem ops
â”‚   â”œâ”€â”€ scanTree.ts           # Shared scanner
â”‚   â””â”€â”€ driftDetector.ts      # Drift detection
â””â”€â”€ utils/
    â”œâ”€â”€ pathUtils.ts          # Path validation
    â””â”€â”€ validation.ts         # Tree validation
```

## ğŸš§ What's NOT Included

- âŒ JSON mode (removed in v2.0)
- âŒ Toggle mode command
- âŒ Undo functionality
- âŒ Git integration
- âŒ File content editing
- âŒ Auto-apply on save

## ğŸ“ Examples

### Add Files

```markdown
# Before

src/
â”œâ”€ index.ts <!-- id: abc123 -->

# After

src/
â”œâ”€ index.ts <!-- id: abc123 -->
â”œâ”€ utils.ts <!-- NEW -->
â””â”€ types.ts <!-- NEW -->
```

**Result:** `utils.ts` and `types.ts` created

### Rename Files

```markdown
# Before

src/
â”œâ”€ OldName.tsx <!-- id: abc123 -->

# After

src/
â”œâ”€ NewName.tsx <!-- id: abc123 -->
```

**Result:** File renamed (UUID preserved â†’ RENAME detected)

### Move Files

```markdown
# Before

â”œâ”€ Button.tsx <!-- id: abc123 -->
â””â”€ components/

# After

â””â”€ components/
â””â”€ Button.tsx <!-- id: abc123 -->
```

**Result:** File moved into `components/` folder

### Delete Files

```markdown
# Before

â”œâ”€ obsolete.tsx <!-- id: abc123 -->
â”œâ”€ current.tsx <!-- id: def456 -->

# After

â””â”€ current.tsx <!-- id: def456 -->
```

**Result:** `obsolete.tsx` deleted (with confirmation)

## ğŸ› Troubleshooting

### "No baseline tree found"

**Cause:** Haven't generated a tree yet

**Solution:** Right-click folder â†’ Generate Markdown Tree

### "Filesystem drift detected"

**Cause:** Files changed outside the extension

**Solution:**

1. Choose "Refresh Baseline" to regenerate from filesystem
2. Or "Continue Anyway" if you know what you're doing

### Changes not detected

**Cause:** UUID might be missing or changed

**Solution:** Keep UUIDs intact when editing

## ğŸ”„ Version History

### v2.1.0 - Critical Bug Fix

- âœ… **FIXED: Parser creating files from headers/comments** (critical bug)
- âœ… Format version comment added
- âœ… Updated shortcuts in footer
- âœ… Apply from preview document support
- âœ… UUID missing warnings

### v2.0.0 - Major Update

- âœ… Markdown-only (JSON mode removed)
- âœ… Tree symbols in output
- âœ… UUID-based tracking
- âœ… Filesystem drift detection
- âœ… Keybindings (Ctrl+Shift+Enter, Ctrl+Enter)
- âœ… Auto-close temporary documents
- âœ… Enhanced safety checks

### v1.0.1 - Bugfixes

- Fixed baseline tracking
- Added right-click support
- Code cleanup

### v1.0.0 - Initial Release

- Basic Markdown/JSON modes
- Tree generation
- Apply changes

## ğŸ“„ License

MIT

---

**âš¡ FILETREEFORGE v2.0** - Professional folder structure editing for VS Code
